# Сервис для сбора статистики по определённому поисковому запросу.

## Технические детали.
Технологии: `Python/asyncio`, `FastAPI`, `SQLAlchemy (PostgreSQL)`, `Docker / docker-compose`, `APScheduler`, `grpc`

### Описание эндпоинтов:

`POST /add` - добавляет необходимый поисковый запрос в систему для генерации статистики. Поисковый запрос сохраняется в базу данных в таблицу Task, после чего регистируется
задача в APScheduler. Данная задача с течением времени опрашивает/парсит нужный сервис (в данном случае wildberries), и сохраняет данные в дочернюю
таблицу Statistic. Если задача уже имеется в базе, то в ответ пользователю об этом сообщается и высылается id существующей задачи.

`POST /show` - принимает в body: время (ISO 8601) и id задачи. В ответ отдаётся вся статистика по заданному промежутку времени.

`POST /stop/id` -  позволяет остановить сбор статистики по определённому поисковому запросу (задача не удаляется из базы данных, удаляется лишь сама задача
планировщика).

`POST /start/id` - позволяет запустить сбор статистики по остановленной задаче.

При запуске проекта, начинается инициализация всех активных задач в базе и начинается их выполнение.

# Развертывание.

1. Клонировать репозиторий.

```
~$ git clone https://github.com/neekrasov/stats-service_api.git
```

2. Создать файл .env на примере .env.example .
```
~$ cp .env.example docker/.env
```

3. Поднять контейнеры.
```
~$ make compose-up
```
4. Открыть в браузере http://localhost/api/docs .
  
