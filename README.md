# Сервис для сбора статистики по определённому поисковому запросу.
## Реализовано
1. Сам сервис
2. Покрытие тестами на 92% (pytest coverage)
3. Конфиг для развертывания контейнеров `docker-compose.yml`
## Технические детали
Технологии: `Python/asyncio`, `FastAPI`, `SQLAlchemy (PostgreSQL)`, `Docker / docker-compose`, `APScheduler`

В проекте имеются несколько ручек. 

`POST ./add` - добавляет необходимый поисковый запрос в систему для генерации статистики. Поисковый запрос сохраняется в базу данных в таблицу Task, после чего регистируется
задача в APScheduler. Данная задача с течением времени опрашивает/парсит нужный сервис (в случае данного сервиса это wildberries), и сохраняет нужные данные в дочернюю
таблицу Statistic. Если задача уже имеется в базе, то в ответ пользователю об этом сообщается, а так же высылается id существующей задачи.

`POST /show` - принимает в body время (ISO 8601) и id задачи, в ответ отдаёт всю статистику по заданному промежутку времени.

`POST /stop:id` -  позволяет остановить сбор статистики по определённому поисковому запросу. Замечание: задача не удаляется из базы данных, удаляется лишь сама задача
APScheduler`a

`POST /start:id` - позволяет заново запустить сбор статистики по остановленному запросу.

При запуске проекта, начинается инициализация всех активных задач в базе, для выполнения.

# Развертывание.

1. Клонирование репозитория

```
git clone https://github.com/neekrasov/stats-service_api.git
```

2. Создать `.env.prod` файл и указать необходимые значения в соответсвии с файлом `.env-example`

3. Поднять контейнеры
```
docker compose up
```
4. Открыть в браузере http://127.0.0.1/docs
  